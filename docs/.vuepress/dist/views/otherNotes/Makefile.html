<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Makefile | Coloring</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="We beat on the boats against the current.">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="/assets/css/0.styles.6dcf3714.css" as="style"><link rel="preload" href="/assets/js/app.12534202.js" as="script"><link rel="preload" href="/assets/js/3.3275429a.js" as="script"><link rel="preload" href="/assets/js/1.97ecb029.js" as="script"><link rel="preload" href="/assets/js/38.f0a51a63.js" as="script"><link rel="prefetch" href="/assets/js/10.c978ae0a.js"><link rel="prefetch" href="/assets/js/11.036e9537.js"><link rel="prefetch" href="/assets/js/12.4b5f2216.js"><link rel="prefetch" href="/assets/js/13.1669d2ea.js"><link rel="prefetch" href="/assets/js/14.a6558952.js"><link rel="prefetch" href="/assets/js/15.0ec36145.js"><link rel="prefetch" href="/assets/js/16.555e041a.js"><link rel="prefetch" href="/assets/js/17.caa0e107.js"><link rel="prefetch" href="/assets/js/18.5a691b3e.js"><link rel="prefetch" href="/assets/js/19.06f2a46d.js"><link rel="prefetch" href="/assets/js/20.0a70569e.js"><link rel="prefetch" href="/assets/js/21.6a59b04c.js"><link rel="prefetch" href="/assets/js/22.25e82912.js"><link rel="prefetch" href="/assets/js/23.68f35fb7.js"><link rel="prefetch" href="/assets/js/24.e742cddd.js"><link rel="prefetch" href="/assets/js/25.97645b78.js"><link rel="prefetch" href="/assets/js/26.8b563143.js"><link rel="prefetch" href="/assets/js/27.c86a57bd.js"><link rel="prefetch" href="/assets/js/28.6b1e2e5c.js"><link rel="prefetch" href="/assets/js/29.f9b50025.js"><link rel="prefetch" href="/assets/js/30.b1103572.js"><link rel="prefetch" href="/assets/js/31.097c33e1.js"><link rel="prefetch" href="/assets/js/32.1011a38f.js"><link rel="prefetch" href="/assets/js/33.ad4cc8f5.js"><link rel="prefetch" href="/assets/js/34.85dd29a7.js"><link rel="prefetch" href="/assets/js/35.4425c421.js"><link rel="prefetch" href="/assets/js/36.70caa22c.js"><link rel="prefetch" href="/assets/js/37.073232a9.js"><link rel="prefetch" href="/assets/js/39.3532b2bb.js"><link rel="prefetch" href="/assets/js/4.cb0d85f9.js"><link rel="prefetch" href="/assets/js/40.568c1d4c.js"><link rel="prefetch" href="/assets/js/41.a4b50133.js"><link rel="prefetch" href="/assets/js/42.21df5539.js"><link rel="prefetch" href="/assets/js/43.48ee0f43.js"><link rel="prefetch" href="/assets/js/5.a6872ff8.js"><link rel="prefetch" href="/assets/js/6.02f11781.js"><link rel="prefetch" href="/assets/js/7.ad07af39.js"><link rel="prefetch" href="/assets/js/8.2c68d8b8.js"><link rel="prefetch" href="/assets/js/9.553fb9b2.js">
    <link rel="stylesheet" href="/assets/css/0.styles.6dcf3714.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar" data-v-1156296a><div data-v-1156296a><div id="loader-wrapper" class="loading-wrapper" data-v-d48f4d20 data-v-1156296a data-v-1156296a><div class="loader-main" data-v-d48f4d20><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-4e82dffc data-v-1156296a data-v-1156296a><h3 class="title" data-v-4e82dffc data-v-4e82dffc>Coloring</h3> <p class="description" data-v-4e82dffc data-v-4e82dffc>We beat on the boats against the current.</p> <label id="box" class="inputBox" data-v-4e82dffc data-v-4e82dffc><input type="password" value="" data-v-4e82dffc> <span data-v-4e82dffc>Konck! Knock!</span> <button data-v-4e82dffc>OK</button></label> <div class="footer" data-v-4e82dffc data-v-4e82dffc><span data-v-4e82dffc><i class="iconfont reco-theme" data-v-4e82dffc></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-4e82dffc>vuePress-theme-reco</a></span> <span data-v-4e82dffc><i class="iconfont reco-copyright" data-v-4e82dffc></i> <a data-v-4e82dffc><!---->
            
          <span data-v-4e82dffc>2019 - </span>
          2022
        </a></span></div></div> <div class="hide" data-v-1156296a><header class="navbar" data-v-1156296a><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/head.png" alt="Coloring" class="logo"> <span class="site-name">Coloring</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/算法/" class="nav-link"><i class="undefined"></i>
  算法
</a></li><li class="dropdown-item"><!----> <a href="/categories/DeepLearning/" class="nav-link"><i class="undefined"></i>
  DeepLearning
</a></li><li class="dropdown-item"><!----> <a href="/categories/Java/" class="nav-link"><i class="undefined"></i>
  Java
</a></li><li class="dropdown-item"><!----> <a href="/categories/otherNotes/" class="nav-link"><i class="undefined"></i>
  otherNotes
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><a href="https://github.com/Colo-ring" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-1156296a></div> <aside class="sidebar" data-v-1156296a><div class="personal-info-wrapper" data-v-828910c6 data-v-1156296a><img src="/head.png" alt="author-avatar" class="personal-img" data-v-828910c6> <!----> <div class="num" data-v-828910c6><div data-v-828910c6><h3 data-v-828910c6>31</h3> <h6 data-v-828910c6>Articles</h6></div> <div data-v-828910c6><h3 data-v-828910c6>28</h3> <h6 data-v-828910c6>Tags</h6></div></div> <ul class="social-links" data-v-828910c6></ul> <hr data-v-828910c6></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/算法/" class="nav-link"><i class="undefined"></i>
  算法
</a></li><li class="dropdown-item"><!----> <a href="/categories/DeepLearning/" class="nav-link"><i class="undefined"></i>
  DeepLearning
</a></li><li class="dropdown-item"><!----> <a href="/categories/Java/" class="nav-link"><i class="undefined"></i>
  Java
</a></li><li class="dropdown-item"><!----> <a href="/categories/otherNotes/" class="nav-link"><i class="undefined"></i>
  otherNotes
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><a href="https://github.com/Colo-ring" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav> <!----> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-4e82dffc data-v-1156296a><h3 class="title" data-v-4e82dffc data-v-4e82dffc>Makefile</h3> <!----> <label id="box" class="inputBox" data-v-4e82dffc data-v-4e82dffc><input type="password" value="" data-v-4e82dffc> <span data-v-4e82dffc>Konck! Knock!</span> <button data-v-4e82dffc>OK</button></label> <div class="footer" data-v-4e82dffc data-v-4e82dffc><span data-v-4e82dffc><i class="iconfont reco-theme" data-v-4e82dffc></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-4e82dffc>vuePress-theme-reco</a></span> <span data-v-4e82dffc><i class="iconfont reco-copyright" data-v-4e82dffc></i> <a data-v-4e82dffc><!---->
            
          <span data-v-4e82dffc>2019 - </span>
          2022
        </a></span></div></div> <div data-v-1156296a><main class="page"><section><div class="page-title"><h1 class="title">Makefile</h1> <div class="page-info" data-v-067d6889><!----> <i class="iconfont reco-date" data-v-067d6889><span data-v-067d6889>7/30/2021</span></i> <!----> <i class="tags iconfont reco-tag" data-v-067d6889><span class="tag-item" data-v-067d6889>linux</span><span class="tag-item" data-v-067d6889>C</span></i></div></div> <div class="theme-reco-content content__default"><h2 id="makefile-介绍"><a href="#makefile-介绍" class="header-anchor">#</a> Makefile 介绍</h2> <h3 id="一、makefile-规则"><a href="#一、makefile-规则" class="header-anchor">#</a> 一、Makefile 规则</h3> <div class="language-makefile extra-class"><pre class="language-makefile"><code><span class="token symbol">target</span><span class="token punctuation">:</span> prerequisites ...
command
...
...
</code></pre></div><ul><li><strong>target</strong> 可以是一个 object file（目标文件），也可以是一个执行文件，还可以是一个标签（label）。</li> <li><strong>prerequisites</strong> 生成该 target 所依赖的文件和/或 target</li> <li><strong>command</strong> 该 target 要执行的命令（任意的 shell 命令） 这是一个文件的依赖关系，也就是说，target 这一个或多个的目标文件依赖于 prerequisites 中的文件，其生成规则定义在 command 中。</li></ul> <p><strong>prerequisites 中如果有一个以上的文件比 target 文件要新的话，command 所定义的命令就会被执行。</strong></p> <p><strong>示例：</strong></p> <div class="language-makefile extra-class"><pre class="language-makefile"><code><span class="token symbol">edit</span> <span class="token punctuation">:</span> main.o kbd.o command.o display.o \
		insert.o search.o files.o utils.o
	cc -o edit main.o kbd.o command.o display.o \
		insert.o search.o files.o utils.o
		
<span class="token symbol">main.o</span> <span class="token punctuation">:</span> main.c defs.h
	cc -c main.c
<span class="token symbol">kbd.o</span> <span class="token punctuation">:</span> kbd.c defs.h command.h
	cc -c kbd.c
<span class="token symbol">command.o</span> <span class="token punctuation">:</span> command.c defs.h command.h
	cc -c command.c
<span class="token symbol">display.o</span> <span class="token punctuation">:</span> display.c defs.h buffer.h
	cc -c display.c
<span class="token symbol">insert.o</span> <span class="token punctuation">:</span> insert.c defs.h buffer.h
	cc -c insert.c
<span class="token symbol">search.o</span> <span class="token punctuation">:</span> search.c defs.h buffer.h
	cc -c search.c
<span class="token symbol">files.o</span> <span class="token punctuation">:</span> files.c defs.h buffer.h command.h
	cc -c files.c
<span class="token symbol">utils.o</span> <span class="token punctuation">:</span> utils.c defs.h
	cc -c utils.c
<span class="token symbol">clean</span> <span class="token punctuation">:</span>
	rm edit main.o kbd.o command.o display.o \
        insert.o search.o files.o utils.o
</code></pre></div><p>在默认的方式下，我们只输入 make 命令。</p> <ol><li>make 会在当前目录下找名字叫“Makefile”或“makefile”的文件。</li> <li>如果找到，它会找文件中的第一个目标文件，在上面的例子中，他会找到 <code>edit</code> 这个文 件，并把这个文件作为最终的目标文件。</li> <li>如果 edit 文件不存在，或是 edit 所依赖的后面的 .o 文件的文件修改时间要比 edit 这个文件新， 那么，他就会执行后面所定义的命令来生成 edit 这个文件。</li> <li>如果 edit 所依赖的 .o 文件也不存在，那么 make 会在当前文件中找目标为 .o 文件的依赖性，如 果找到则再根据那一个规则生成 .o 文件。（点像一个堆栈的过程）</li> <li>当然， C 文件和 H 文件得存在，于是 make 会生成 .o 文件，然后再用 .o 文件生成 make 的终极任务，也就是执行文件 edit 了。</li></ol> <h3 id="二、makefile-变量"><a href="#二、makefile-变量" class="header-anchor">#</a> 二、Makefile 变量</h3> <p><strong>定义变量：</strong></p> <div class="language-makefile extra-class"><pre class="language-makefile"><code>OBJS<span class="token operator">=</span>main.o tool1.o tool2.o
</code></pre></div><p><strong>使用变量：</strong></p> <div class="language-makefile extra-class"><pre class="language-makefile"><code>OBJS<span class="token operator">=</span>main.o tool1.o tool2.o
CC<span class="token operator">=</span>gcc
CFLAGS<span class="token operator">+=</span>-c -Wall -g

<span class="token symbol">mytool</span><span class="token punctuation">:</span><span class="token variable">$</span><span class="token punctuation">(</span>OBJS<span class="token punctuation">)</span>
	<span class="token variable">$</span><span class="token punctuation">(</span>CC<span class="token punctuation">)</span> <span class="token variable">$</span><span class="token punctuation">(</span>OBJS<span class="token punctuation">)</span> -o mytool
	
<span class="token symbol">main.o</span><span class="token punctuation">:</span>main.c
	<span class="token variable">$</span><span class="token punctuation">(</span>CC<span class="token punctuation">)</span> main.c <span class="token variable">$</span><span class="token punctuation">(</span>CFLAGS<span class="token punctuation">)</span> -o main.o
<span class="token symbol">tool1.o</span><span class="token punctuation">:</span>tool1.c
	<span class="token variable">$</span><span class="token punctuation">(</span>CC<span class="token punctuation">)</span> tool1.c <span class="token variable">$</span><span class="token punctuation">(</span>CFLAGS<span class="token punctuation">)</span> -o tool1.o
<span class="token symbol">tool2.o</span><span class="token punctuation">:</span>tool2.c
	<span class="token variable">$</span><span class="token punctuation">(</span>CC<span class="token punctuation">)</span> tool2.c <span class="token variable">$</span><span class="token punctuation">(</span>CFLAGS<span class="token punctuation">)</span> -o tool2.o
	
<span class="token symbol">clean</span><span class="token punctuation">:</span>
	<span class="token variable">$</span><span class="token punctuation">(</span>RM<span class="token punctuation">)</span> *.o mytool -r
</code></pre></div><p><strong>OBJS：</strong> 变量，自定义</p> <p><strong>CC：</strong> 指定编译器</p> <p><strong>CFLAGS：</strong> 指定编译指令</p> <p><strong>RM：</strong> 默认为<code>rm -f</code></p> <hr> <p><code>$^</code>：所有依赖的文件，即<code>OBJS</code></p> <p><code>$@</code>：所有的目标文件，即<code>mytool</code></p> <p><strong>简写：</strong></p> <div class="language-makefile extra-class"><pre class="language-makefile"><code>OBJS<span class="token operator">=</span>main.o tool1.o tool2.o
CC<span class="token operator">=</span>gcc
CFLAGS<span class="token operator">+=</span>-c -Wall -g

<span class="token symbol">mytool</span><span class="token punctuation">:</span><span class="token variable">$</span><span class="token punctuation">(</span>OBJS<span class="token punctuation">)</span>
	<span class="token variable">$</span><span class="token punctuation">(</span>CC<span class="token punctuation">)</span> <span class="token variable">$^</span> -o <span class="token variable">$@</span>
	
<span class="token symbol">main.o</span><span class="token punctuation">:</span>main.c
	<span class="token variable">$</span><span class="token punctuation">(</span>CC<span class="token punctuation">)</span> <span class="token variable">$^</span> <span class="token variable">$</span><span class="token punctuation">(</span>CFLAGS<span class="token punctuation">)</span> -o <span class="token variable">$@</span>
<span class="token symbol">tool1.o</span><span class="token punctuation">:</span>tool1.c
	<span class="token variable">$</span><span class="token punctuation">(</span>CC<span class="token punctuation">)</span> <span class="token variable">$^</span> <span class="token variable">$</span><span class="token punctuation">(</span>CFLAGS<span class="token punctuation">)</span> -o <span class="token variable">$@</span>
<span class="token symbol">tool2.o</span><span class="token punctuation">:</span>tool2.c
	<span class="token variable">$</span><span class="token punctuation">(</span>CC<span class="token punctuation">)</span> <span class="token variable">$^</span> <span class="token variable">$</span><span class="token punctuation">(</span>CFLAGS<span class="token punctuation">)</span> -o <span class="token variable">$@</span>
		
<span class="token symbol">clean</span><span class="token punctuation">:</span>
	<span class="token variable">$</span><span class="token punctuation">(</span>RM<span class="token punctuation">)</span> *.o mytool -r
</code></pre></div><hr> <p><strong>%：</strong> 通配符</p> <p><strong>%.o:%.c：</strong> 表示目标文件.o需要同名的依赖文件.c</p> <p><strong>简写：</strong></p> <div class="language-makefile extra-class"><pre class="language-makefile"><code>OBJS<span class="token operator">=</span>main.o tool1.o tool2.o
CC<span class="token operator">=</span>gcc
CFLAGS<span class="token operator">+=</span>-c -Wall -g

<span class="token symbol">mytool</span><span class="token punctuation">:</span><span class="token variable">$</span><span class="token punctuation">(</span>OBJS<span class="token punctuation">)</span>
	<span class="token variable">$</span><span class="token punctuation">(</span>CC<span class="token punctuation">)</span> <span class="token variable">$^</span> -o <span class="token variable">$@</span>
	
<span class="token symbol">%.o</span><span class="token punctuation">:</span>%.c
	<span class="token variable">$</span><span class="token punctuation">(</span>CC<span class="token punctuation">)</span> <span class="token variable">$^</span> <span class="token variable">$</span><span class="token punctuation">(</span>CFLAGS<span class="token punctuation">)</span> -o <span class="token variable">$@</span>
		
<span class="token symbol">clean</span><span class="token punctuation">:</span>
	<span class="token variable">$</span><span class="token punctuation">(</span>RM<span class="token punctuation">)</span> *.o mytool -r
</code></pre></div><hr> <p><strong>GUN 自动推导：</strong></p> <p>只要 make 看到一个 .o 文件，它就会自动的把 .c 文件加在依赖关系中，如果 make 找到一个 whatever.o ，那么 whatever.c 就会是 whatever.o 的依赖文件。并且 cc -c whatever.c 也会被推导出来。</p> <h2 id="makefile-书写规则"><a href="#makefile-书写规则" class="header-anchor">#</a> Makefile 书写规则</h2> <h3 id="一、使用通配符"><a href="#一、使用通配符" class="header-anchor">#</a> 一、使用通配符</h3> <p>make 支持三个通配符： * ，? 和 ~ 。这是和 Unix 的 B-Shell 是相同的。</p> <div class="language-makefile extra-class"><pre class="language-makefile"><code>objects <span class="token operator">=</span> *.o
</code></pre></div><p>并不是说 *.o 会展开，不！objects 的值就是 *.o 。<strong>Makefile 中的变量其实就是 C/C++ 中的宏。</strong></p> <p>如果要让通配符在变量中展开，也就是让 objects 的值是所有 .o 的文件名的集合，那么，可以这样：</p> <div class="language-makefile extra-class"><pre class="language-makefile"><code>objects <span class="token operator">:=</span> <span class="token variable">$</span><span class="token punctuation">(</span><span class="token keyword">wildcard</span> *.o<span class="token punctuation">)</span>
</code></pre></div><p><strong>例：</strong></p> <div class="language-makefile extra-class"><pre class="language-makefile"><code><span class="token comment"># 1、列出一确定文件夹中的所有 .c 文件。</span>
objects <span class="token operator">:=</span> <span class="token variable">$</span><span class="token punctuation">(</span><span class="token keyword">wildcard</span> *.o<span class="token punctuation">)</span>

<span class="token comment"># 2、列出 1 中所有文件对应的 .o 文件，在 3 中我们可以看到它是由 make 自动编译出的:</span>
<span class="token variable">$</span><span class="token punctuation">(</span><span class="token keyword">patsubst</span> %.c,%.o,<span class="token variable">$</span><span class="token punctuation">(</span><span class="token keyword">wildcard</span> *.c<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 由 1、2 两步，可写出编译并链接所有 .c 和 .o 文件</span>
objects <span class="token operator">:=</span> <span class="token variable">$</span><span class="token punctuation">(</span><span class="token keyword">patsubst</span> %.c,%.o,<span class="token variable">$</span><span class="token punctuation">(</span><span class="token keyword">wildcard</span> *.c<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token symbol">foo</span> <span class="token punctuation">:</span> <span class="token variable">$</span><span class="token punctuation">(</span>objects<span class="token punctuation">)</span>
	cc -o foo <span class="token variable">$</span><span class="token punctuation">(</span>objects<span class="token punctuation">)</span>
</code></pre></div><h3 id="二、文件搜寻"><a href="#二、文件搜寻" class="header-anchor">#</a> 二、文件搜寻</h3> <p>Makefile 文件中的特殊变量 VPATH 完成自动寻找路径，如果没有指明这个变量，make 只会在当前的目录中去找寻依赖文件和目标文件。如果定义了这个变量，那么，make 就会在当前目录找不到的情况下，到所指定的目录中去找寻文件了。</p> <div class="language-makefile extra-class"><pre class="language-makefile"><code>VPATH <span class="token operator">=</span> src<span class="token punctuation">:</span>../headers
</code></pre></div><p>上面的定义指定两个目录，<code>src</code> 和 <code>../headers</code>，make 会按照这个顺序进行搜索。目录由<strong>冒号</strong>分隔。（当然，当前目录永远是最高优先搜索的地方）</p> <p>另一个设置文件搜索路径的方法是使用 make 的 <strong>vpath</strong> 关键字（全小写），这不是变量，这是一个 make 的关键字，它可以指定不同的文件在不同的搜索目录中。</p> <ul><li><code>vpath &lt;pattern&gt; &lt;directories&gt;</code>：为符合模式 pattern 的文件指定搜索目录 directories</li> <li><code>vpath &lt;pattern&gt;</code> ：清除符合模式的文件的搜索目录</li> <li><code>vpath</code> ：清除所有已被设置好了的文件搜索目录</li></ul> <div class="language-makefile extra-class"><pre class="language-makefile"><code><span class="token comment"># %：匹配零或若干字符</span>
<span class="token keyword">vpath</span> %.h ../headers
<span class="token comment"># 要求 make 在“../headers”目录下搜索所有以 .h 结尾的文件。（如果某文件在当前目录没有找到的话）</span>
</code></pre></div><p>我们可以连续地使用 vpath 语句，以指定不同搜索策略。如果连续的 vpath 语句中出现了相同的 <code>&lt;pattern&gt;</code>，或是被重复了的 <code>&lt;pattern&gt;</code>，那么，make 会按照 vpath 语句的先后顺序来执行搜索。如：</p> <div class="language-makefile extra-class"><pre class="language-makefile"><code><span class="token keyword">vpath</span> %.c foo
<span class="token keyword">vpath</span> %.c blish
<span class="token keyword">vpath</span> %.c bar
<span class="token comment"># 表示.c 结尾的文件，先在“foo”目录，然后是“blish”，最后是“bar”目录。</span>

<span class="token symbol">vpath %.c foo</span><span class="token punctuation">:</span>bar
<span class="token keyword">vpath</span> %.c blish
<span class="token comment"># 表示 .c 结尾的文件，先在“foo”目录，然后是“bar”目录，最后才是“blish”目录。</span>
</code></pre></div><h3 id="三、伪目标"><a href="#三、伪目标" class="header-anchor">#</a> 三、伪目标</h3> <div class="language-makefile extra-class"><pre class="language-makefile"><code><span class="token symbol">clean</span><span class="token punctuation">:</span>
	<span class="token variable">$</span><span class="token punctuation">(</span>RM<span class="token punctuation">)</span> *.o mytool -r
</code></pre></div><ul><li>我们并不生成 “clean” 这个文件。</li> <li>“伪目标” 并不是一个文件，只是一个标签，由于 “伪目标” 不是文件，所以 make 无法生成它的依赖关系和决定它是否要执行。</li> <li>我们只有通过显式地指明这个 “目标” 才能让其生效。</li></ul> <p>为了避免和文件重名的这种情况，我们可以使用一个特殊的标记 <code>.PHONY</code> 来显式地指明 一个目标是 “伪目标”，向 make 说明，不管是否有这个文件，这个目标就是 “伪目标”。</p> <div class="language-makefile extra-class"><pre class="language-makefile"><code><span class="token builtin">.PHONY</span> <span class="token punctuation">:</span> clean
</code></pre></div><p>只要有这个声明，不管是否有 “clean” 文件，要运行 “clean” 这个目标，只有 “make clean” 这样。 于是整个过程可以这样写：</p> <div class="language-makefile extra-class"><pre class="language-makefile"><code><span class="token builtin">.PHONY</span> <span class="token punctuation">:</span> clean
<span class="token symbol">clean</span> <span class="token punctuation">:</span>
	<span class="token variable">$</span><span class="token punctuation">(</span>RM<span class="token punctuation">)</span> *.o mytool -r
</code></pre></div><hr> <p>伪目标一般没有依赖的文件。但是，我们也可以为伪目标指定所依赖的文件。伪目标同样可以作为 “默认目标”，只要将其放在第一个。一个示例就是，如果 Makefile 需要<strong>一口气生成若干个可执行文件</strong>，但只想简单地敲一个 make 完事，并且，所有的目标文件都写在一个 Makefile 中，那么可以使用 “伪目标” 这个特性：</p> <div class="language-makefile extra-class"><pre class="language-makefile"><code><span class="token symbol">all</span> <span class="token punctuation">:</span> prog1 prog2 prog3
<span class="token builtin">.PHONY</span> <span class="token punctuation">:</span> all

<span class="token symbol">prog1</span> <span class="token punctuation">:</span> prog1.o utils.o
	cc -o prog1 prog1.o utils.o
<span class="token symbol">prog2</span> <span class="token punctuation">:</span> prog2.o
	cc -o prog2 prog2.o
<span class="token symbol">prog3</span> <span class="token punctuation">:</span> prog3.o sort.o utils.o
	cc -o prog3 prog3.o sort.o utils.o
</code></pre></div><p>Makefile 中的第一个目标会被作为其默认目标。我们声明了一个 <code>all</code> 的伪目标，其依赖于其它三个目标。由于默认目标的特性是，总是被执行的，但由于“all”又是一个伪目标，伪目标只是一个标签不会生成文件，所以不会有“all”文件产生。于是，其它三个目标的规则总是会被决议。也就达到了我们一口气生成多个目标的目的。<code>.PHONY : all</code> 声明了 “all” 这个目标为 “伪目标”。</p> <hr> <p><strong>从上面的例子我们可以看出，目标也可以成为依赖。所以，伪目标同样也可成为依赖：</strong></p> <div class="language-makefile extra-class"><pre class="language-makefile"><code><span class="token builtin">.PHONY</span> <span class="token punctuation">:</span> cleanall cleanobj cleandiff
<span class="token symbol">cleanall</span> <span class="token punctuation">:</span> cleanobj cleandiff
	rm program
<span class="token symbol">cleanobj</span> <span class="token punctuation">:</span>
	rm *.o
<span class="token symbol">cleandiff</span> <span class="token punctuation">:</span>
	rm *.diff
</code></pre></div><p><code>make cleanall</code> 将清除所有要被清除的文件。<code>cleanobj</code> 和 <code>cleandiff</code> 这两个伪目标有点像 <code>子程序</code> 的意思。我们可以输入<code>make cleanall</code> 和 <code>make cleanobj</code> 和 <code>make cleandiff</code> 命令来达到清除不同种类文件的目的。</p> <h3 id="四、嵌套执行make"><a href="#四、嵌套执行make" class="header-anchor">#</a> 四、嵌套执行make</h3> <p>在一些大的工程中，我们会把我们不同模块或是不同功能的源文件放在不同的目录中，我们可以在每个目录中都书写一个该目录的 Makefile，这有利于让我们的 Makefile 变得更加地简洁，而不至于把所有的东西全部写在一个 Makefile 中，这样会很难维护我们的 Makefile，这个技术对于我们模块编译和分段编译有着非常大的好处。</p> <p>例如，我们有一个子目录叫 subdir，这个目录下有个 Makefile 文件，来指明了这个目录下文件的编译规则。那么我们总控的 Makefile 可以这样书写：</p> <div class="language-makefile extra-class"><pre class="language-makefile"><code><span class="token symbol">subsystem</span><span class="token punctuation">:</span>
	cd subdir &amp;&amp; <span class="token variable">$</span><span class="token punctuation">(</span>MAKE<span class="token punctuation">)</span>

<span class="token comment"># 等价于</span>
<span class="token symbol">subsystem</span><span class="token punctuation">:</span>
	cd subdir &amp;&amp; <span class="token variable">$</span><span class="token punctuation">(</span>MAKE<span class="token punctuation">)</span>
	
<span class="token comment"># 先进入“subdir”目录，然后执行 make 命令。</span>
</code></pre></div><p>**我们把这个 Makefile 叫做 “总控 Makefile” **，总控 Makefile 的变量可以传递到下级的 Makefile 中（如果你显示的声明），但是不会覆盖下层的 Makefile 中所定义的变量，除非指定了 <code>-e</code> 参数。</p> <h2 id="使用变量"><a href="#使用变量" class="header-anchor">#</a> 使用变量</h2> <h3 id="一、变量中的变量"><a href="#一、变量中的变量" class="header-anchor">#</a> 一、变量中的变量</h3> <div class="language-makefile extra-class"><pre class="language-makefile"><code>x <span class="token operator">:=</span> foo
y <span class="token operator">:=</span> <span class="token variable">$</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> bar
x <span class="token operator">:=</span> late

<span class="token comment"># 等价于</span>
y <span class="token operator">:=</span> foo bar
x <span class="token operator">:=</span> later
</code></pre></div><p><strong>这种方法，前面的变量不能使用后面的变量，只能使用前面已定义好了的变量</strong></p> <p><strong>一个复杂的例子，其中包括了 make 的函数、条件表达式和一个系统变量“MAKELEVEL”的使用：</strong></p> <div class="language-makefile extra-class"><pre class="language-makefile"><code><span class="token keyword">ifeq</span> <span class="token punctuation">(</span>0,<span class="token variable">$</span><span class="token punctuation">{</span>MAKELEVEL<span class="token punctuation">}</span><span class="token punctuation">)</span>
cur-dir <span class="token operator">:=</span> <span class="token variable">$</span><span class="token punctuation">(</span><span class="token keyword">shell</span> pwd<span class="token punctuation">)</span>
whoami <span class="token operator">:=</span> <span class="token variable">$</span><span class="token punctuation">(</span><span class="token keyword">shell</span> whoami<span class="token punctuation">)</span>
host-type <span class="token operator">:=</span> <span class="token variable">$</span><span class="token punctuation">(</span><span class="token keyword">shell</span> arch<span class="token punctuation">)</span>
MAKE <span class="token operator">:=</span> <span class="token variable">$</span><span class="token punctuation">{</span>MAKE<span class="token punctuation">}</span> host-type<span class="token operator">=</span><span class="token variable">$</span><span class="token punctuation">{</span>host-type<span class="token punctuation">}</span> whoami<span class="token operator">=</span><span class="token variable">$</span><span class="token punctuation">{</span>whoami<span class="token punctuation">}</span>
<span class="token keyword">endif</span>
</code></pre></div><p><strong>定义一个空格：</strong></p> <div class="language-makefile extra-class"><pre class="language-makefile"><code>nullstring <span class="token operator">:=</span>
space <span class="token operator">:=</span> <span class="token variable">$</span><span class="token punctuation">(</span>nullstring<span class="token punctuation">)</span> <span class="token comment"># end of the line</span>
<span class="token comment"># 注释和$(nullstring)之间有一个空格，所以space值为一个空格</span>

dir <span class="token operator">:=</span> /foo/bar    <span class="token comment"># directory to put the frobs in</span>
<span class="token comment"># dir 这个变量的值是“/foo/bar”，后面还跟了 4 个空格，如果我们这样使用这样变量来指定别的目录——“$(dir)/file”那么就完蛋了。</span>
</code></pre></div><p><strong>?= 操作符：</strong></p> <div class="language-makefile extra-class"><pre class="language-makefile"><code>FOO <span class="token operator">?=</span> bar
</code></pre></div><p><strong>其含义是，如果 FOO 没有被定义过，那么变量 FOO 的值就是 “bar”，如果 FOO 先前被定义过， 那么这条语将什么也不做</strong>，其等价于：</p> <div class="language-makefile extra-class"><pre class="language-makefile"><code><span class="token keyword">ifeq</span> <span class="token punctuation">(</span><span class="token variable">$</span><span class="token punctuation">(</span><span class="token keyword">origin</span> FOO<span class="token punctuation">)</span>, undefined<span class="token punctuation">)</span>
FOO <span class="token operator">=</span> bar
<span class="token keyword">endif</span>
</code></pre></div><h3 id="二、变量的高级用法"><a href="#二、变量的高级用法" class="header-anchor">#</a> 二、变量的高级用法</h3> <p><strong>1、变量值的替换：</strong></p> <p><code>$(var:a=b) 或是 ${var:a=b}</code> ，其意思是，把变量 “var” 中所有以 “a” 字串结尾的 “a” 替换成 “b” 字串。</p> <div class="language-makefile extra-class"><pre class="language-makefile"><code>foo <span class="token operator">:=</span> a.o b.o c.o
bar <span class="token operator">:=</span> <span class="token variable">$</span><span class="token punctuation">(</span>foo<span class="token punctuation">:</span>.o<span class="token operator">=</span>.c<span class="token punctuation">)</span>
<span class="token comment">#  $(bar) 的值就是“a.c b.c c.c”。</span>
</code></pre></div><p>另外一种变量替换的技术是以 <strong>“静态模式”</strong> 定义的：</p> <div class="language-makefile extra-class"><pre class="language-makefile"><code>foo <span class="token operator">:=</span> a.o b.o c.o
bar <span class="token operator">:=</span> <span class="token variable">$</span><span class="token punctuation">(</span>foo<span class="token punctuation">:</span>%.o<span class="token operator">=</span>%.c<span class="token punctuation">)</span>
</code></pre></div><p><strong>2、把变量的值再当成变量：</strong></p> <div class="language-makefile extra-class"><pre class="language-makefile"><code>x <span class="token operator">=</span> y
y <span class="token operator">=</span> z
a <span class="token operator">:=</span> <span class="token variable">$</span><span class="token punctuation">(</span><span class="token variable">$</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><hr> <div class="language-makefile extra-class"><pre class="language-makefile"><code><span class="token comment">#subst 函数把“variable1”中的所有“1”字串替换成“2”字串，于是，“variable1”变成“variable2”，再取其值，所以最终，$(a) 的值就是 $(variable2) 的值——“Hello”。</span>
x <span class="token operator">=</span> variable1
variable2 <span class="token operator">:=</span> Hello
y <span class="token operator">=</span> <span class="token variable">$</span><span class="token punctuation">(</span><span class="token keyword">subst</span> 1,2,<span class="token variable">$</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>
z <span class="token operator">=</span> y
a <span class="token operator">:=</span> <span class="token variable">$</span><span class="token punctuation">(</span><span class="token variable">$</span><span class="token punctuation">(</span><span class="token variable">$</span><span class="token punctuation">(</span>z<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 多个变量来组成一个变量的名字，然后再取其值：</span>
first_second <span class="token operator">=</span> Hello
a <span class="token operator">=</span> first
b <span class="token operator">=</span> second
all <span class="token operator">=</span> <span class="token variable">$</span><span class="token punctuation">(</span><span class="token variable">$a_$b</span><span class="token punctuation">)</span>

a_objects <span class="token operator">:=</span> a.o b.o c.o
1_objects <span class="token operator">:=</span> 1.o 2.o 3.o
<span class="token comment"># 如果 $(a1) 的值是“a”的话，那么，$(sources) 的值就是“a.c b.c c.c”；如果 $(a1)的值是“1”，那么 $(sources) 的值是“1.c 2.c 3.c”。</span>
sources <span class="token operator">:=</span> <span class="token variable">$</span><span class="token punctuation">(</span><span class="token variable">$</span><span class="token punctuation">(</span>a1<span class="token punctuation">)</span>_objects<span class="token punctuation">:</span>.o<span class="token operator">=</span>.c<span class="token punctuation">)</span>
</code></pre></div><h2 id="使用函数"><a href="#使用函数" class="header-anchor">#</a> 使用函数</h2> <h3 id="一、字符串处理函数"><a href="#一、字符串处理函数" class="header-anchor">#</a> 一、字符串处理函数</h3> <h4 id="_1、subst"><a href="#_1、subst" class="header-anchor">#</a> 1、subst</h4> <div class="language-makefile extra-class"><pre class="language-makefile"><code><span class="token variable">$</span><span class="token punctuation">(</span><span class="token keyword">subst</span> &lt;from&gt;,&lt;to&gt;,&lt;text&gt;<span class="token punctuation">)</span>
</code></pre></div><ul><li>名称：字符串替换函数</li> <li>功能：把字串中的字符串替换成</li> <li>返回：函数返回被替换过后的字符串</li> <li>示例：<code>$(subst ee,EE,feet on the street)</code> <ul><li>把 feet on the street 中的 ee 替换成 EE，返回结果是 fEEt on the strEEt 。</li></ul></li></ul> <h4 id="_2、patsubst"><a href="#_2、patsubst" class="header-anchor">#</a> 2、patsubst</h4> <div class="language-makefile extra-class"><pre class="language-makefile"><code><span class="token variable">$</span><span class="token punctuation">(</span><span class="token keyword">patsubst</span> &lt;pattern&gt;,&lt;replacement&gt;,&lt;text&gt;<span class="token punctuation">)</span>
</code></pre></div><ul><li>名称：模式字符串替换函数</li> <li>功能：查找<code>&lt;text&gt;</code>中的单词（单词以“空格”、“Tab”或“回车”“换行”分隔）是否符合模式 <code>&lt;pattern&gt;</code>，如果匹配的话，则以<code>&lt;replacement&gt;</code>替换。这里，<code>&lt;pattern&gt;</code> 可以包括通配符 % ， 表示任意长度的字串。如果<code>&lt;replacement&gt;</code>中也包含 % ，那么，中的这个 % 将是中的那个 % 所代表的字串。（可以用 \ 来转义，以 % 来表示真实含义的 % 字符）</li> <li>返回：函数返回被替换过后的字符串</li> <li>示例： <code>$(patsubst %.c,%.o,x.c.c bar.c)</code> <ul><li>把字串 x.c.c bar.c 符合模式 %.c 的单词替换成 %.o ，返回结果是 x.c.o bar.o</li></ul></li></ul> <h4 id="_3、strip"><a href="#_3、strip" class="header-anchor">#</a> 3、strip</h4> <div class="language-makefile extra-class"><pre class="language-makefile"><code><span class="token variable">$</span><span class="token punctuation">(</span><span class="token keyword">strip</span> &lt;string&gt;<span class="token punctuation">)</span>
</code></pre></div><ul><li>名称：去空格函数</li> <li>功能：去掉<code>&lt;string&gt;</code>字串中开头和结尾的空字符</li> <li>返回：返回被去掉空格的字符串值</li> <li>示例： <code>$(strip a b c )</code></li></ul> <h4 id="_4、findstring"><a href="#_4、findstring" class="header-anchor">#</a> 4、findstring</h4> <div class="language-makefile extra-class"><pre class="language-makefile"><code><span class="token variable">$</span><span class="token punctuation">(</span><span class="token keyword">findstring</span> &lt;find&gt;,&lt;in&gt;<span class="token punctuation">)</span>
</code></pre></div><ul><li>名称：查找字符串函数</li> <li>功能：在字串<code>&lt;in&gt;</code>中查找<code>&lt;find&gt;</code>字串。</li> <li>返回：如果找到，那么返回<code>&lt;find&gt;</code>，否则返回空字符串</li> <li>示例： <code>$(findstring a,a b c) $(findstring a,b c)</code> <ul><li>第一个函数返回 a 字符串，第二个返回空字符串</li></ul></li></ul> <h4 id="_5、filter"><a href="#_5、filter" class="header-anchor">#</a> 5、filter</h4> <div class="language-makefile extra-class"><pre class="language-makefile"><code><span class="token variable">$</span><span class="token punctuation">(</span><span class="token keyword">filter</span> &lt;pattern...&gt;,&lt;text&gt;<span class="token punctuation">)</span>
</code></pre></div><ul><li><p>名称：过滤函数</p></li> <li><p>功能：以<code>&lt;pattern&gt;</code>模式过滤<code>&lt;text&gt;</code>字符串中的单词，保留符合模式<code>&lt;pattern&gt;</code>的单词。可以有多个模式</p></li> <li><p>返回：返回符合模式<code>&lt;pattern&gt;</code>的字串。</p></li> <li><p>示例：</p> <div class="language-makefile extra-class"><pre class="language-makefile"><code>sources <span class="token operator">:=</span> foo.c bar.c baz.s ugh.h
<span class="token symbol">foo</span><span class="token punctuation">:</span> <span class="token variable">$</span><span class="token punctuation">(</span>sources<span class="token punctuation">)</span>
	cc <span class="token variable">$</span><span class="token punctuation">(</span><span class="token keyword">filter</span> %.c %.s,<span class="token variable">$</span><span class="token punctuation">(</span>sources<span class="token punctuation">)</span><span class="token punctuation">)</span> -o foo
</code></pre></div><ul><li><code>$(filter %.c %.s,$(sources))</code>返回的值是 foo.c bar.c baz.s 。</li></ul></li></ul> <hr> <p><a href="https://blog.csdn.net/xiaoshuai537/article/details/79340153" target="_blank" rel="noopener noreferrer">等等等等<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <ul><li>filter-out</li> <li>sort</li> <li>word</li> <li>wordlist</li> <li>words</li> <li>firstword</li></ul> <hr> <h3 id="二、文件名操作函数"><a href="#二、文件名操作函数" class="header-anchor">#</a> 二、文件名操作函数</h3> <ul><li>dir</li> <li>notdir</li> <li>suffix</li> <li>basename</li> <li>addsuffix</li> <li>addprefix</li> <li>join</li></ul> <h3 id="三、foreach-函数"><a href="#三、foreach-函数" class="header-anchor">#</a> 三、foreach 函数</h3> <p>foreach 函数和别的函数非常的不一样。因为这个函数是用来做循环用的，Makefile 中的 foreach 函 数几乎是仿照于 Unix 标准 Shell（/bin/sh）中的 for 语句，或是 C-Shell（/bin/csh）中的 foreach 语句 而构建的。它的语法是：</p> <div class="language-makefile extra-class"><pre class="language-makefile"><code><span class="token variable">$</span><span class="token punctuation">(</span><span class="token keyword">foreach</span> &lt;var&gt;,&lt;list&gt;,&lt;text&gt;<span class="token punctuation">)</span>
</code></pre></div><p>这个函数的意思是，把参数 list 中的单词逐一取出放到参数 var 所指定的变量中，然后再执 text 行所包含的表达式。每一次 text 会返回一个字符串，循环过程中， text 的所返回的每个字符串会以空格分隔，最后当整个循环结束时， 所返回的每个字符串所组成的整个字符串（以空格分隔）将会是 foreach 函数的返回值。</p> <h3 id="四、call-函数"><a href="#四、call-函数" class="header-anchor">#</a> 四、call 函数</h3> <div class="language-makefile extra-class"><pre class="language-makefile"><code><span class="token variable">$</span><span class="token punctuation">(</span><span class="token keyword">call</span> &lt;expression&gt;,&lt;parm1&gt;,&lt;parm2&gt;,...,&lt;parmn&gt;<span class="token punctuation">)</span> 
</code></pre></div><p>当 make 执行这个函数时， <code>&lt;expression&gt;</code>参数中的变量，如 <code>$(1)</code> 、<code>$(2)</code> 等，会被参数 <code>&lt;parm1&gt; 、 &lt;parm2&gt; 、&lt;parm3&gt;</code> 依次取代。而 <code>&lt;expression&gt;</code> 的返回值就是 call 函数的返回值。</p> <div class="language-makefile extra-class"><pre class="language-makefile"><code>reverse <span class="token operator">=</span> <span class="token variable">$</span><span class="token punctuation">(</span>1<span class="token punctuation">)</span> <span class="token variable">$</span><span class="token punctuation">(</span>2<span class="token punctuation">)</span>
foo <span class="token operator">=</span> <span class="token variable">$</span><span class="token punctuation">(</span><span class="token keyword">call</span> reverse,a,b<span class="token punctuation">)</span>
</code></pre></div><p>需要注意：在向 call 函数传递参数时要尤其注意空格的使用。call 函数在处理参数时，第 2 个及其之后的参数中的空格会被保留，因而可能造成一些奇怪的效果。因而在向 call 函数提供参数时，最安全的做法是去除所有多余的空格。</p> <h3 id="五、origin-函数"><a href="#五、origin-函数" class="header-anchor">#</a> 五、origin 函数</h3> <p>origin 函数只是告诉这个变量是哪里来的</p> <div class="language-makefile extra-class"><pre class="language-makefile"><code><span class="token variable">$</span><span class="token punctuation">(</span><span class="token keyword">origin</span> &lt;variable&gt;<span class="token punctuation">)</span>
</code></pre></div><p>注意， <code>&lt;variable&gt;</code>是变量的名字，不应该是引用。所以你最好不要在 <code>&lt;variable&gt;</code> 中使用 $ 字符。</p> <ul><li><strong>undefined</strong> 如果 <code>&lt;variable&gt;</code> 从来没有定义过，origin 函数返回这个值</li> <li><strong>undefined default</strong> 如果 <code>&lt;variable&gt;</code> 是一个默认的定义，比如“CC”这个变量</li> <li><strong>environment</strong> 如果 <code>&lt;variable&gt;</code> 是一个环境变量，并且当 Makefile 被执行时，-e 参数没有被打开</li> <li><strong>file</strong> 如果 <code>&lt;variable&gt;</code> 这个变量被定义在 Makefile 中</li> <li><strong>command line</strong> 如果 <code>&lt;variable&gt;</code> 这个变量是被命令行定义的</li> <li><strong>override</strong> 如果 <code>&lt;variable&gt;</code> 是被 override 指示符重新定义的</li> <li><strong>automatic</strong> 如果 <code>&lt;variable&gt;</code> 是一个命令运行中的自动化变量</li></ul> <h3 id="六、shell-函数"><a href="#六、shell-函数" class="header-anchor">#</a> 六、shell 函数</h3> <p>shell 函数的参数是操作系统 Shell 的命令，把执行命令后的输出作为函数返回。</p> <div class="language-makefile extra-class"><pre class="language-makefile"><code>contents <span class="token operator">:=</span> <span class="token variable">$</span><span class="token punctuation">(</span><span class="token keyword">shell</span> cat foo<span class="token punctuation">)</span>
files <span class="token operator">:=</span> <span class="token variable">$</span><span class="token punctuation">(</span><span class="token keyword">shell</span> echo *.c<span class="token punctuation">)</span>
</code></pre></div><p>注意，这个函数会新生成一个 Shell 程序来执行命令，所以要注意其运行性能，如果你的 Makefile 中有一些比较复杂的规则，并大量使用了这个函数，那么对于系统性能是有害的。特别是 Makefile 的隐晦的规则可能会让 shell 函数执行的次数比想像的多得多。</p> <h2 id="makefile-的运行"><a href="#makefile-的运行" class="header-anchor">#</a> Makefile 的运行</h2> <h3 id="_1、make-的退出码"><a href="#_1、make-的退出码" class="header-anchor">#</a> 1、make 的退出码</h3> <ul><li><strong>0</strong> 表示成功执行</li> <li><strong>1</strong> 如果 make 运行时出现任何错误，其返回 1。</li> <li><strong>2</strong> 如果使用了 make 的“-q”选项，并且 make 使得一些目标不需要更新，那么返回 2。</li></ul> <h3 id="_2、指定-makefile"><a href="#_2、指定-makefile" class="header-anchor">#</a> 2、指定 Makefile</h3> <p>GNU make 找寻默认的 Makefile 的规则是在当前目录下依次找三个文件：</p> <ul><li>GNU-makefile</li> <li>makefile</li> <li>Makefile</li></ul> <p>我们也可以给 make 命令指定一个特殊名字的 Makefile。要达到这个功能，我们要使用 make 的 -f 或是 --file 参数（--makefile 参数也行）。例如，我们有个 makefile 的名字是“hchen.mk”，那么，我们可以这样来让 make 来执行这个文件：</p> <div class="language-makefile extra-class"><pre class="language-makefile"><code>make –f hchen.mk
</code></pre></div><h3 id="_3、指定目标"><a href="#_3、指定目标" class="header-anchor">#</a> 3、指定目标</h3> <p>一般来说，make 的最终目标是 makefile 中的第一个目标，而其它目标一般是由这个目标连带出来的。这是 make 的默认行为。</p> <p>可以指示 make，让其完成所指定的目标。在 make 命令后直接跟目标的名字就可以完成：如 <code>make clean</code></p> <p>有一个 make 的环境变量叫 <code>MAKECMDGOALS</code>，这个变量中会存放所指定的终极目标的列表，如果在命令行上没有指定目标，那么，这个变量是空值。这个变量可以使用在一些比较特殊的情形 下。比如：</p> <div class="language-makefile extra-class"><pre class="language-makefile"><code>sources <span class="token operator">=</span> foo.c bar.c
<span class="token keyword">ifneq</span> <span class="token punctuation">(</span> <span class="token variable">$</span><span class="token punctuation">(</span>MAKECMDGOALS<span class="token punctuation">)</span>,clean<span class="token punctuation">)</span>
<span class="token symbol">	include <span class="token variable">$</span>(sources</span><span class="token punctuation">:</span>.c<span class="token operator">=</span>.d<span class="token punctuation">)</span>
<span class="token keyword">endif</span>
</code></pre></div><p><strong>使用指定终极目标的方法可以很方便地让我们编译我们的程序：</strong></p> <div class="language-makefile extra-class"><pre class="language-makefile"><code><span class="token builtin">.PHONY</span><span class="token punctuation">:</span> all
<span class="token symbol">all</span><span class="token punctuation">:</span> prog1 prog2 prog3 prog4
</code></pre></div><p><strong>我们可以使用“make all”命令来编译所有的目标，如果把 all 置成第一个目标，那么只需执行“make”</strong></p> <p>即然 make 可以指定所有 makefile 中的目标，那么也包括“伪目标”，于是我们可以根据这种性质来让我们的 makefile 根据指定的不同的目标来完成不同的事。</p> <ul><li><strong>all</strong>: 这个伪目标是所有目标的目标，其功能一般是编译所有的目标</li> <li><strong>clean</strong>: 这个伪目标功能是删除所有被 make 创建的文件</li> <li><strong>install</strong>: 这个伪目标功能是安装已编译好的程序，其实就是把目标执行文件拷贝到指定的目标中去</li> <li><strong>print</strong>: 这个伪目标的功能是例出改变过的源文件</li> <li><strong>tar</strong>: 这个伪目标功能是把源程序打包备份。也就是一个 tar 文件</li> <li><strong>dist</strong>: 这个伪目标功能是创建一个压缩文件，一般是把 tar 文件压成 Z 文件或是 gz 文件</li> <li><strong>TAGS</strong>: 这个伪目标功能是更新所有的目标，以备完整地重编译使用</li> <li><strong>check 和 test</strong>: 这两个伪目标一般用来测试 makefile 的流程</li></ul> <h3 id="_4、检查规则"><a href="#_4、检查规则" class="header-anchor">#</a> 4、检查规则</h3> <p>有时候，我们不想让我们的 makefile 中的规则执行起来，我们只想检查一下我们的命令，或是执行的序列。于是我们可以使用 make 命令的下述参数：</p> <img src="https://typora-img-1307960409.cos.ap-shanghai.myqcloud.com/img/image-20210730101415701.png" alt="image-20210730101415701" style="zoom:67%;"> <h3 id="_5、make-的参数"><a href="#_5、make-的参数" class="header-anchor">#</a> 5、make 的参数</h3> <img src="https://typora-img-1307960409.cos.ap-shanghai.myqcloud.com/img/image-20210730101603552.png" alt="image-20210730101603552" style="zoom:67%;"> <img src="https://typora-img-1307960409.cos.ap-shanghai.myqcloud.com/img/image-20210730101712843.png" alt="image-20210730101712843" style="zoom:67%;"> <img src="https://typora-img-1307960409.cos.ap-shanghai.myqcloud.com/img/image-20210730101735095.png" alt="image-20210730101735095" style="zoom:67%;"> <img src="https://typora-img-1307960409.cos.ap-shanghai.myqcloud.com/img/image-20210730101756318.png" alt="image-20210730101756318" style="zoom:67%;"></div></section> <footer class="page-edit"><!----> <!----></footer> <!----> <div class="comments-wrapper"><!----></div> <ul class="side-bar sub-sidebar-wrapper" style="width:12rem;" data-v-70334359><li class="level-2" data-v-70334359><a href="/views/otherNotes/Makefile.html#makefile-介绍" class="sidebar-link reco-side-makefile-介绍" data-v-70334359>Makefile 介绍</a></li><li class="level-3" data-v-70334359><a href="/views/otherNotes/Makefile.html#一、makefile-规则" class="sidebar-link reco-side-一、makefile-规则" data-v-70334359>一、Makefile 规则</a></li><li class="level-3" data-v-70334359><a href="/views/otherNotes/Makefile.html#二、makefile-变量" class="sidebar-link reco-side-二、makefile-变量" data-v-70334359>二、Makefile 变量</a></li><li class="level-2" data-v-70334359><a href="/views/otherNotes/Makefile.html#makefile-书写规则" class="sidebar-link reco-side-makefile-书写规则" data-v-70334359>Makefile 书写规则</a></li><li class="level-3" data-v-70334359><a href="/views/otherNotes/Makefile.html#一、使用通配符" class="sidebar-link reco-side-一、使用通配符" data-v-70334359>一、使用通配符</a></li><li class="level-3" data-v-70334359><a href="/views/otherNotes/Makefile.html#二、文件搜寻" class="sidebar-link reco-side-二、文件搜寻" data-v-70334359>二、文件搜寻</a></li><li class="level-3" data-v-70334359><a href="/views/otherNotes/Makefile.html#三、伪目标" class="sidebar-link reco-side-三、伪目标" data-v-70334359>三、伪目标</a></li><li class="level-3" data-v-70334359><a href="/views/otherNotes/Makefile.html#四、嵌套执行make" class="sidebar-link reco-side-四、嵌套执行make" data-v-70334359>四、嵌套执行make</a></li><li class="level-2" data-v-70334359><a href="/views/otherNotes/Makefile.html#使用变量" class="sidebar-link reco-side-使用变量" data-v-70334359>使用变量</a></li><li class="level-3" data-v-70334359><a href="/views/otherNotes/Makefile.html#一、变量中的变量" class="sidebar-link reco-side-一、变量中的变量" data-v-70334359>一、变量中的变量</a></li><li class="level-3" data-v-70334359><a href="/views/otherNotes/Makefile.html#二、变量的高级用法" class="sidebar-link reco-side-二、变量的高级用法" data-v-70334359>二、变量的高级用法</a></li><li class="level-2" data-v-70334359><a href="/views/otherNotes/Makefile.html#使用函数" class="sidebar-link reco-side-使用函数" data-v-70334359>使用函数</a></li><li class="level-3" data-v-70334359><a href="/views/otherNotes/Makefile.html#一、字符串处理函数" class="sidebar-link reco-side-一、字符串处理函数" data-v-70334359>一、字符串处理函数</a></li><li class="level-3" data-v-70334359><a href="/views/otherNotes/Makefile.html#二、文件名操作函数" class="sidebar-link reco-side-二、文件名操作函数" data-v-70334359>二、文件名操作函数</a></li><li class="level-3" data-v-70334359><a href="/views/otherNotes/Makefile.html#三、foreach-函数" class="sidebar-link reco-side-三、foreach-函数" data-v-70334359>三、foreach 函数</a></li><li class="level-3" data-v-70334359><a href="/views/otherNotes/Makefile.html#四、call-函数" class="sidebar-link reco-side-四、call-函数" data-v-70334359>四、call 函数</a></li><li class="level-3" data-v-70334359><a href="/views/otherNotes/Makefile.html#五、origin-函数" class="sidebar-link reco-side-五、origin-函数" data-v-70334359>五、origin 函数</a></li><li class="level-3" data-v-70334359><a href="/views/otherNotes/Makefile.html#六、shell-函数" class="sidebar-link reco-side-六、shell-函数" data-v-70334359>六、shell 函数</a></li><li class="level-2" data-v-70334359><a href="/views/otherNotes/Makefile.html#makefile-的运行" class="sidebar-link reco-side-makefile-的运行" data-v-70334359>Makefile 的运行</a></li><li class="level-3" data-v-70334359><a href="/views/otherNotes/Makefile.html#_1、make-的退出码" class="sidebar-link reco-side-_1、make-的退出码" data-v-70334359>1、make 的退出码</a></li><li class="level-3" data-v-70334359><a href="/views/otherNotes/Makefile.html#_2、指定-makefile" class="sidebar-link reco-side-_2、指定-makefile" data-v-70334359>2、指定 Makefile</a></li><li class="level-3" data-v-70334359><a href="/views/otherNotes/Makefile.html#_3、指定目标" class="sidebar-link reco-side-_3、指定目标" data-v-70334359>3、指定目标</a></li><li class="level-3" data-v-70334359><a href="/views/otherNotes/Makefile.html#_4、检查规则" class="sidebar-link reco-side-_4、检查规则" data-v-70334359>4、检查规则</a></li><li class="level-3" data-v-70334359><a href="/views/otherNotes/Makefile.html#_5、make-的参数" class="sidebar-link reco-side-_5、make-的参数" data-v-70334359>5、make 的参数</a></li></ul></main> <!----></div></div></div></div><div class="global-ui"><div></div><div class="kanbanniang" data-v-5775ee02><div class="banniang-container" style="display:;" data-v-5775ee02><div class="messageBox" style="right:8px;bottom:210px;display:none;" data-v-5775ee02>
      欢迎来到 Coloring
    </div> <div class="operation" style="right:8px;bottom:50px;display:none;" data-v-5775ee02><i class="kbnfont kbn-ban-home ban-home" data-v-5775ee02></i> <i class="kbnfont kbn-ban-message message" data-v-5775ee02></i> <i class="kbnfont kbn-ban-close close" data-v-5775ee02></i> <a target="_blank" href="https://vuepress-theme-reco.recoluan.com/views/plugins/kanbanniang.html" data-v-5775ee02><i class="kbnfont kbn-ban-info info" data-v-5775ee02></i></a> <i class="kbnfont kbn-ban-theme skin" style="display:;" data-v-5775ee02></i></div> <canvas id="banniang" width="150" height="220" class="live2d" style="right:50px;bottom:0px;opacity:1.0;" data-v-5775ee02></canvas></div> <div class="showBanNiang" style="display:none;" data-v-5775ee02>
    看板娘
  </div></div><APlayer audio="" fixed="true" mini="true" autoplay="autoplay" theme="#FFB6C1" loop="loop" order="list" preload="auto" volume="0.1" mutex="true" lrc-type="0" list-folded="true" list-max-height="250" storage-name="vuepress-plugin-meting" id="aplayer-fixed"></APlayer><canvas id="vuepress-canvas-cursor"></canvas><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div></div></div>
    <script src="/assets/js/app.12534202.js" defer></script><script src="/assets/js/3.3275429a.js" defer></script><script src="/assets/js/1.97ecb029.js" defer></script><script src="/assets/js/38.f0a51a63.js" defer></script>
  </body>
</html>
